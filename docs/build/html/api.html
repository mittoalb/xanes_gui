

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Reference &mdash; XANES GUI 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8d563738"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Features" href="features.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            XANES GUI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-application-class">Main Application Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xanesgui">XANESGui</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#XANESGui"><code class="docutils literal notranslate"><span class="pre">XANESGui</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#worker-threads">Worker Threads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#calibrationworker">CalibrationWorker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#CalibrationWorker"><code class="docutils literal notranslate"><span class="pre">CalibrationWorker</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#startscriptworker">StartScriptWorker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#StartScriptWorker"><code class="docutils literal notranslate"><span class="pre">StartScriptWorker</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#epics-interface">EPICS Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pv-operations">PV Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-format-specifications">File Format Specifications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#npy-files">NPY Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csv-files">CSV Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-energy-arrays">Custom Energy Arrays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#settings-file-format">Settings File Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-structure">JSON Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extending-the-gui">Extending the GUI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-energy-methods">Adding New Energy Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-curve-processing">Adding Custom Curve Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-epics-pvs">Adding New EPICS PVs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constants-and-defaults">Constants and Defaults</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-values">Default Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#k-edge-database">K-Edge Database</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling">Error Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exception-classes">Exception Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling-pattern">Error Handling Pattern</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unit-test-example">Unit Test Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-test-example">Integration Test Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#development-guidelines">Development Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code-style">Code Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XANES GUI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h1>
<p>This page provides detailed API documentation for developers.</p>
<section id="main-application-class">
<h2>Main Application Class<a class="headerlink" href="#main-application-class" title="Link to this heading"></a></h2>
<section id="xanesgui">
<h3>XANESGui<a class="headerlink" href="#xanesgui" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="XANESGui">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XANESGui</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">QMainWindow</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui" title="Link to this definition"></a></dt>
<dd><p>Main application window for XANES GUI.</p>
<p><strong>Initialization:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
<span class="n">gui</span> <span class="o">=</span> <span class="n">XANESGui</span><span class="p">()</span>
<span class="n">gui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">curve_data</span></code> (dict): Stores loaded curve data as {label: (energies, intensities)}</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">current_edge_energy</span></code> (float): Currently selected K-edge energy in keV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calibration_energies</span></code> (list): Energy points from calibration scan</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calibration_sums</span></code> (list): Detector sums from calibration scan</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_energies</span></code> (numpy.ndarray): Custom energy array for Method 3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pv_settings</span></code> (dict): EPICS PV configuration and paths</p></li>
</ul>
<p><strong>Methods:</strong></p>
<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.load_curve">
<span class="sig-name descname"><span class="pre">load_curve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.load_curve" title="Link to this definition"></a></dt>
<dd><p>Load a reference curve from NPY or CSV file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Path to curve file</p></li>
<li><p><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Display label (optional, defaults to filename)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if loaded successfully</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.plot_curve">
<span class="sig-name descname"><span class="pre">plot_curve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">energies</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intensities</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.plot_curve" title="Link to this definition"></a></dt>
<dd><p>Plot a curve on the main plot widget.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>energies</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – Energy values in keV</p></li>
<li><p><strong>intensities</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – Intensity values (arbitrary units)</p></li>
<li><p><strong>label</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a>) – Curve label for legend</p></li>
<li><p><strong>color</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.14)"><em>tuple</em></a>) – Plot color (optional, auto-assigned if None)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.calculate_edge_shift">
<span class="sig-name descname"><span class="pre">calculate_edge_shift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">energies</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intensities</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theoretical_edge</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.calculate_edge_shift" title="Link to this definition"></a></dt>
<dd><p>Calculate edge shift from calibrated curve.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>energies</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – Energy values in keV</p></li>
<li><p><strong>intensities</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – Intensity values</p></li>
<li><p><strong>theoretical_edge</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><em>float</em></a>) – Theoretical edge energy in keV</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Edge shift in eV</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)">float</a></p>
</dd>
</dl>
<p><strong>Algorithm:</strong></p>
<ol class="arabic simple">
<li><p>Normalize intensities to [0, 1]</p></li>
<li><p>Calculate derivative</p></li>
<li><p>Find maximum derivative position (measured edge)</p></li>
<li><p>Return (measured - theoretical) * 1000</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.start_calibration">
<span class="sig-name descname"><span class="pre">start_calibration</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.start_calibration" title="Link to this definition"></a></dt>
<dd><p>Launch calibration scan in background thread.</p>
<p>Creates a <code class="docutils literal notranslate"><span class="pre">CalibrationWorker</span></code> thread and connects signals.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.start_xanes_script">
<span class="sig-name descname"><span class="pre">start_xanes_script</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.start_xanes_script" title="Link to this definition"></a></dt>
<dd><p>Launch XANES acquisition script.</p>
<p>Creates a <code class="docutils literal notranslate"><span class="pre">StartScriptWorker</span></code> thread and executes configured bash script.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.stop_scan">
<span class="sig-name descname"><span class="pre">stop_scan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.stop_scan" title="Link to this definition"></a></dt>
<dd><p>Abort current calibration or script operation.</p>
<p>Sends stop signals to worker threads and triggers safety PVs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.load_settings">
<span class="sig-name descname"><span class="pre">load_settings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.load_settings" title="Link to this definition"></a></dt>
<dd><p>Load GUI settings from JSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Settings dictionary</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)">dict</a></p>
</dd>
</dl>
<p>Settings file: <code class="docutils literal notranslate"><span class="pre">~/.xanes_gui_settings.json</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="XANESGui.save_settings">
<span class="sig-name descname"><span class="pre">save_settings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#XANESGui.save_settings" title="Link to this definition"></a></dt>
<dd><p>Save current GUI settings to JSON file.</p>
<p>Persists PV configuration, paths, and UI state.</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="worker-threads">
<h2>Worker Threads<a class="headerlink" href="#worker-threads" title="Link to this heading"></a></h2>
<section id="calibrationworker">
<h3>CalibrationWorker<a class="headerlink" href="#calibrationworker" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="CalibrationWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CalibrationWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">QThread</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CalibrationWorker" title="Link to this definition"></a></dt>
<dd><p>Background thread for calibration scans.</p>
<p><strong>Signals:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">progress_update(int)</span></code> - Emits progress percentage (0-100)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_message(str)</span></code> - Emits log messages for display</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scan_complete()</span></code> - Emitted when scan finishes successfully</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_point(float,</span> <span class="pre">float)</span></code> - Emits (energy, detector_sum) for each point</p></li>
</ul>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">energies</span></code> (list): Energy points to scan</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pv_settings</span></code> (dict): EPICS PV configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_requested</span></code> (bool): Flag for abort request</p></li>
</ul>
<p><strong>Methods:</strong></p>
<dl class="py method">
<dt class="sig sig-object py" id="CalibrationWorker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CalibrationWorker.run" title="Link to this definition"></a></dt>
<dd><p>Execute calibration scan.</p>
<p>For each energy point:</p>
<ol class="arabic simple">
<li><p>Set energy via EPICS PV</p></li>
<li><p>Wait for readback confirmation (if configured)</p></li>
<li><p>Apply settling time</p></li>
<li><p>Trigger detector acquisition</p></li>
<li><p>Wait for acquisition complete</p></li>
<li><p>Read detector image via PVAccess</p></li>
<li><p>Sum all pixels</p></li>
<li><p>Emit data_point signal</p></li>
</ol>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CalibrationWorker.request_stop">
<span class="sig-name descname"><span class="pre">request_stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CalibrationWorker.request_stop" title="Link to this definition"></a></dt>
<dd><p>Request scan abort.</p>
<p>Sets <code class="docutils literal notranslate"><span class="pre">stop_requested</span></code> flag; scan aborts after current point.</p>
</dd></dl>

</dd></dl>

</section>
<section id="startscriptworker">
<h3>StartScriptWorker<a class="headerlink" href="#startscriptworker" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="StartScriptWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">StartScriptWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">QThread</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StartScriptWorker" title="Link to this definition"></a></dt>
<dd><p>Background thread for XANES script execution.</p>
<p><strong>Signals:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">log_message(str)</span></code> - Emits script output lines</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">script_complete(int)</span></code> - Emits script return code</p></li>
</ul>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">script_path</span></code> (str): Path to bash script</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">process</span></code> (subprocess.Popen): Script process</p></li>
</ul>
<p><strong>Methods:</strong></p>
<dl class="py method">
<dt class="sig sig-object py" id="StartScriptWorker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#StartScriptWorker.run" title="Link to this definition"></a></dt>
<dd><p>Execute bash script and stream output.</p>
<p>Uses <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code> with process group for clean termination.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="StartScriptWorker.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#StartScriptWorker.stop" title="Link to this definition"></a></dt>
<dd><p>Terminate script process.</p>
<p>Sends SIGTERM to process group.</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="epics-interface">
<h2>EPICS Interface<a class="headerlink" href="#epics-interface" title="Link to this heading"></a></h2>
<section id="pv-operations">
<h3>PV Operations<a class="headerlink" href="#pv-operations" title="Link to this heading"></a></h3>
<p><strong>Channel Access (pyepics):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">epics</span>

<span class="c1"># Set energy</span>
<span class="n">epics</span><span class="o">.</span><span class="n">caput</span><span class="p">(</span><span class="s1">&#39;32id:TXMOptics:EnergySet&#39;</span><span class="p">,</span> <span class="mf">7.112</span><span class="p">)</span>

<span class="c1"># Read energy</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="s1">&#39;32id:TXMOptics:Energy_RBV&#39;</span><span class="p">)</span>

<span class="c1"># Trigger acquisition</span>
<span class="n">epics</span><span class="o">.</span><span class="n">caput</span><span class="p">(</span><span class="s1">&#39;32idbSP1:cam1:Acquire&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Monitor acquisition status</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="s1">&#39;32idbSP1:cam1:Acquire_RBV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>PVAccess (pvaccess):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pvaccess</span><span class="w"> </span><span class="kn">import</span> <span class="n">Channel</span>

<span class="c1"># Create channel</span>
<span class="n">chan</span> <span class="o">=</span> <span class="n">Channel</span><span class="p">(</span><span class="s1">&#39;32idbSP1:Pva1:Image&#39;</span><span class="p">)</span>

<span class="c1"># Get NTNDArray</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">chan</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<span class="c1"># Extract data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ubyteValue&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="file-format-specifications">
<h2>File Format Specifications<a class="headerlink" href="#file-format-specifications" title="Link to this heading"></a></h2>
<section id="npy-files">
<h3>NPY Files<a class="headerlink" href="#npy-files" title="Link to this heading"></a></h3>
<p><strong>Binary Format:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Save curve</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">energies</span><span class="p">,</span> <span class="n">intensities</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;Fe_calibrated.npy&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Load curve</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;Fe_calibrated.npy&#39;</span><span class="p">)</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">intensities</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Text Format:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Two columns: energy (keV), intensity
6.912 0.123
6.913 0.125
6.914 0.128
</pre></div>
</div>
</section>
<section id="csv-files">
<h3>CSV Files<a class="headerlink" href="#csv-files" title="Link to this heading"></a></h3>
<p><strong>Format:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Comma or space-separated
6.912,0.123
6.913,0.125
6.914,0.128
</pre></div>
</div>
</section>
<section id="custom-energy-arrays">
<h3>Custom Energy Arrays<a class="headerlink" href="#custom-energy-arrays" title="Link to this heading"></a></h3>
<p><strong>Format:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># One energy per line (keV)
6.912
6.913
6.914
</pre></div>
</div>
</section>
</section>
<section id="settings-file-format">
<h2>Settings File Format<a class="headerlink" href="#settings-file-format" title="Link to this heading"></a></h2>
<section id="json-structure">
<h3>JSON Structure<a class="headerlink" href="#json-structure" title="Link to this heading"></a></h3>
<p><strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">~/.xanes_gui_settings.json</span></code></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;pva_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32idbSP1:Pva1:Image&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;acquire_pv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32idbSP1:cam1:Acquire&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;acquire_rbv_pv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32idbSP1:cam1:Acquire_RBV&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;energy_set_pv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32id:TXMOptics:EnergySet&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;energy_rb_pv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32id:TXMOptics:Energy_RBV&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;settle_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.15&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;start_sh_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/home/user/xanes_start.sh&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;calibrated_curves_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/Calibrated/&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;simulated_curves_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/Curves/&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;curve_extension&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;.npy&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;curve_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;calibrated&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;energy_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;overlay_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;start_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6.912&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;end_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7.312&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;step_energy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="extending-the-gui">
<h2>Extending the GUI<a class="headerlink" href="#extending-the-gui" title="Link to this heading"></a></h2>
<section id="adding-new-energy-methods">
<h3>Adding New Energy Methods<a class="headerlink" href="#adding-new-energy-methods" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Add radio button to energy method group:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">method4_radio</span> <span class="o">=</span> <span class="n">QRadioButton</span><span class="p">(</span><span class="s2">&quot;Method 4: Description&quot;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">energy_method_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method4_radio</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create method-specific widget:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">method4_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
<span class="c1"># Add controls to widget</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Add to stacked widget:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">energy_stack</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method4_widget</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Connect to method selection:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">method4_radio</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_stack</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method4_widget</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Implement energy array generation:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_method4_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Generate energy array</span>
    <span class="k">return</span> <span class="n">energies</span>
</pre></div>
</div>
</section>
<section id="adding-custom-curve-processing">
<h3>Adding Custom Curve Processing<a class="headerlink" href="#adding-custom-curve-processing" title="Link to this heading"></a></h3>
<p>Extend <code class="docutils literal notranslate"><span class="pre">calculate_edge_shift</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">custom_edge_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">intensities</span><span class="p">):</span>
    <span class="c1"># Custom algorithm</span>
    <span class="c1"># Return edge position</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="adding-new-epics-pvs">
<h3>Adding New EPICS PVs<a class="headerlink" href="#adding-new-epics-pvs" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Add to PV Settings tab:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">new_pv_entry</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
<span class="n">pv_layout</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="s2">&quot;New PV:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_pv_entry</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Save/load in settings:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">save_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;new_pv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_pv_entry</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_pv_entry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_pv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Use in worker thread:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_pv</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">PV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pv_settings</span><span class="p">[</span><span class="s1">&#39;new_pv&#39;</span><span class="p">])</span>
<span class="n">new_pv</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="constants-and-defaults">
<h2>Constants and Defaults<a class="headerlink" href="#constants-and-defaults" title="Link to this heading"></a></h2>
<section id="default-values">
<h3>Default Values<a class="headerlink" href="#default-values" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Energy defaults</span>
<span class="n">DEFAULT_START_ENERGY</span> <span class="o">=</span> <span class="mf">7.0</span>  <span class="c1"># keV</span>
<span class="n">DEFAULT_END_ENERGY</span> <span class="o">=</span> <span class="mf">7.4</span>    <span class="c1"># keV</span>
<span class="n">DEFAULT_STEP_ENERGY</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># eV</span>

<span class="c1"># Timing defaults</span>
<span class="n">DEFAULT_SETTLE_TIME</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># seconds</span>

<span class="c1"># File extensions</span>
<span class="n">SUPPORTED_EXTENSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">]</span>

<span class="c1"># Plot colors</span>
<span class="n">PLOT_COLORS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#FF6B6B&#39;</span><span class="p">,</span> <span class="s1">&#39;#4ECDC4&#39;</span><span class="p">,</span> <span class="s1">&#39;#45B7D1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;#FFA07A&#39;</span><span class="p">,</span> <span class="s1">&#39;#98D8C8&#39;</span><span class="p">,</span> <span class="s1">&#39;#F7DC6F&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="k-edge-database">
<h3>K-Edge Database<a class="headerlink" href="#k-edge-database" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">EDGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mf">0.0136</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;He&quot;</span><span class="p">,</span> <span class="mf">0.0246</span><span class="p">),</span>
    <span class="c1"># ... (full periodic table)</span>
    <span class="p">(</span><span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="mf">7.112</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Co&quot;</span><span class="p">,</span> <span class="mf">7.709</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ni&quot;</span><span class="p">,</span> <span class="mf">8.333</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h2>
<section id="exception-classes">
<h3>Exception Classes<a class="headerlink" href="#exception-classes" title="Link to this heading"></a></h3>
<p>Custom exceptions for specific errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">EPICSConnectionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when EPICS PV connection fails&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">InvalidEnergyRangeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when energy range is invalid&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CurveLoadError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when curve file cannot be loaded&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="error-handling-pattern">
<h3>Error Handling Pattern<a class="headerlink" href="#error-handling-pattern" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># EPICS operation</span>
    <span class="n">epics</span><span class="o">.</span><span class="n">caput</span><span class="p">(</span><span class="n">pv_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="n">epics</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">CASeverityException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPICS Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<section id="unit-test-example">
<h3>Unit Test Example<a class="headerlink" href="#unit-test-example" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xanes_gui</span><span class="w"> </span><span class="kn">import</span> <span class="n">XANESGui</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestXANESGui</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">XANESGui</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_edge_shift_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">energies</span> <span class="o">-</span> <span class="mf">7.112</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">calculate_edge_shift</span><span class="p">(</span>
            <span class="n">energies</span><span class="p">,</span> <span class="n">intensities</span><span class="p">,</span> <span class="mf">7.112</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">),</span> <span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># Within 5 eV</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="integration-test-example">
<h3>Integration Test Example<a class="headerlink" href="#integration-test-example" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_calibration_scan</span><span class="p">():</span>
    <span class="c1"># Requires EPICS IOC running</span>
    <span class="n">gui</span> <span class="o">=</span> <span class="n">XANESGui</span><span class="p">()</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">start_energy_entry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;7.0&quot;</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">end_energy_entry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;7.2&quot;</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">step_energy_entry</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;10.0&quot;</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">start_calibration</span><span class="p">()</span>
    <span class="c1"># Wait for completion</span>
    <span class="c1"># Verify data</span>
</pre></div>
</div>
</section>
</section>
<section id="development-guidelines">
<h2>Development Guidelines<a class="headerlink" href="#development-guidelines" title="Link to this heading"></a></h2>
<section id="code-style">
<h3>Code Style<a class="headerlink" href="#code-style" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Follow PEP 8</p></li>
<li><p>Use type hints where appropriate</p></li>
<li><p>Document all public methods</p></li>
<li><p>Use descriptive variable names</p></li>
</ul>
</section>
<section id="thread-safety">
<h3>Thread Safety<a class="headerlink" href="#thread-safety" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>All EPICS operations in worker threads</p></li>
<li><p>Use signals/slots for UI updates</p></li>
<li><p>No direct UI manipulation from threads</p></li>
</ul>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Use numpy for array operations</p></li>
<li><p>Minimize plot redraws</p></li>
<li><p>Cache computed values where possible</p></li>
</ul>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="user_guide.html"><span class="doc">User Guide</span></a> - User guide for GUI features</p></li>
<li><p><a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a> - Configuration details</p></li>
<li><p><a class="reference internal" href="troubleshooting.html"><span class="doc">Troubleshooting</span></a> - Common issues and solutions</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="features.html" class="btn btn-neutral float-left" title="Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, APS Beamline 32-ID.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>